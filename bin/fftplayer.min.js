function FFTHistory(t){this.config=t,this.config.length=400,this.data=new Array(this.config.length)}function FFTPlayer(t){this.START_VOLUME=.8,this.LOW_PASS_MULTIPLY=4e3,"undefined"==typeof t?t={}:this.config=t,0==this.config.hasOwnProperty("lowpass")&&(this.config.lowpass=this.LOW_PASS_MULTIPLY),0==this.config.hasOwnProperty("volume")&&(this.config.volume=this.START_VOLUME),this.config.state="init",this.version="1.1.1",this.config=t,this.bufferSize=2048,this.fftSize=512,this.timeOffset=0,this.started=!1,this.muted=!1,this.smoothing=.56,this.smoothing2=.9,this.smoothingDrums=.57,this.smoothingDrums2=.06,this.drumTreshold=.66,this.drumTreshold2=.7,this.drum=0,this.deltaDrum=0,this.drumValue=0,this.createAudioContext()}function FFTPlayerVisualizer(){this.container=document.getElementById("container"),this.uniforms={u_time:{type:"f",value:1},u_volume:{type:"f",value:1},u_volume_minus:{type:"f",value:.3},u_volume_multiply:{type:"f",value:5},u_resolution:{type:"v2",value:new THREE.Vector2}},this.camera=new THREE.Camera,this.camera.position.z=1,this.scene=new THREE.Scene,this.geometry=new THREE.PlaneBufferGeometry(2,2),this.mesh=new THREE.Mesh(this.geometry),this.scene.add(this.mesh),this.renderer=new THREE.WebGLRenderer,this.container.appendChild(this.renderer.domElement)}!function t(e,i,o){function n(r,a){if(!i[r]){if(!e[r]){var h="function"==typeof require&&require;if(!a&&h)return h(r,!0);if(s)return s(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var l=i[r]={exports:{}};e[r][0].call(l.exports,function(t){var i=e[r][1][t];return n(i?i:t)},l,l.exports,t,e,i,o)}return i[r].exports}for(var s="function"==typeof require&&require,r=0;r<o.length;r++)n(o[r]);return n}({1:[function(t,e,i){(function(t){"use strict";if(t.AnalyserNode&&!t.AnalyserNode.prototype.getFloatTimeDomainData){var e=new Uint8Array(2048);t.AnalyserNode.prototype.getFloatTimeDomainData=function(t){this.getByteTimeDomainData(e);for(var i=0,o=t.length;i<o;i++)t[i]=.0078125*(e[i]-128)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]),FFTPlayer.prototype.clear=function(t){var e=document.getElementById(t),i=e.getContext("2d"),o=e.width,n=e.height;i.clearRect(0,0,o,n)},FFTPlayer.prototype.drawWave=function(t,e){if("undefined"==typeof e&&(e=1),this.floatTimeDomainData){var i=document.getElementById(t),o=i.getContext("2d"),n=i.width,s=i.height,r=n/this.floatTimeDomainData.length/e;o.fillStyle="rgba(255, 255, 255, 0.7)";for(var a=(Math.round(n/r),0);a<this.floatTimeDomainData.length*e;a++){var h=1*a/(this.floatTimeDomainData.length*e),u=5*Math.abs(h-.5),l=2/(1+u*u),c=s*this.floatTimeDomainData[a]*l;o.fillRect(r*a,s/2,r,-1*c/2)}}},FFTPlayer.prototype.drawSpectrum=function(t){if(this.frequencyData){var e=document.getElementById(t),i=e.getContext("2d"),o=e.width,n=e.height,s=o/this.frequencyData.length;if(this.frequencyData){i.fillStyle="rgba(255, 255, 255, 0.7)";for(var r=(Math.round(o/s),0);r<this.frequencyData.length;r++){var a=.4*this.frequencyData[r];i.fillRect(s*r,n,s,-1*a)}}}},FFTPlayer.prototype.drawSelector=function(t,e){var i=document.getElementById(t),o=i.getContext("2d");o.fillStyle="rgba(255, 0, 0, 0.7)",o.fillRect(i.width*e,0,2,i.height)},FFTPlayer.prototype.draw=function(t,e,i){if("undefined"==typeof i&&(i=1),e){var o=document.getElementById(t),n=o.getContext("2d"),s=o.width,r=o.height,a=s/e.length;n.fillStyle="rgba(255, 255, 255, 0.7)";for(var h=(Math.round(s/a),0);h<e.length;h++){var u=.4*e[h];n.fillRect(a*h,r,a,-1*u*i)}}},FFTPlayer.prototype.drawCircle=function(t,e,i,o,n){"undefined"==typeof i&&(i=1),"undefined"==typeof o&&(o=5),"undefined"==typeof n&&(n=1);var s=document.getElementById(t),r=s.getContext("2d");if(e){var a=s.width/2,h=s.height/2,u=window.devicePixelRatio*a*.75;r.fillStyle="rgba(255, 255, 255, 0.7)";for(var l=0;l<e.length*n;l++){var c=2*Math.PI*l/e.length/n,f=a+u*Math.cos(c),d=h+u*Math.sin(c);r.translate(f,d),r.rotate(c);var y=e[l];r.fillRect(0,0,i*y,o),r.setTransform(1,0,0,1,0,0)}}},FFTHistory.prototype.update=function(t){this.data.length>this.config.length&&this.data.shift(),this.data.push(t)},FFTHistory.prototype.draw=function(t){"undefined"==typeof my&&(my=1),"undefined"==typeof s&&(s=2),"undefined"==typeof percents&&(percents=1);var e=document.getElementById(t),i=e.getContext("2d");if(this.data){var e=document.getElementById(t),i=e.getContext("2d"),o=e.width,n=e.height,s=o/this.data.length;i.fillStyle="rgba(255, 255, 255, 0.2)";for(var r=(Math.round(o/s),0);r<this.data.length;r++){var a=100.4*this.data[r];i.fillRect(s*r,n,s,-1*a)}}},FFTPlayer.prototype.createAudioContext=function(){console.debug(this.version+" createAudioContext");var t=window.AudioContext||window.webkitAudioContext||!1;t?this.context=new t:(console.error("Sorry, but the Web Audio API is not supported by your browser."),console.error("Please, consider upgrading to the latest version or downloading Google Chrome or Mozilla Firefox"))},FFTPlayer.prototype.analyze=function(t){if(this.analyser){this.analyser.smoothingTimeConstant=this.smoothing,this.analyser2.smoothingTimeConstant=this.smoothing2;var e=t.inputBuffer,i=t.outputBuffer;if(this.analyser.getByteFrequencyData(this.frequencyData),this.analyser2.getByteFrequencyData(this.frequency2Data),this.analyser.getFloatFrequencyData(this.floatFrequencyData),this.analyser.getByteTimeDomainData(this.timeDomainData),this.analyser.getFloatTimeDomainData(this.floatTimeDomainData),this.delta=new Float32Array(this.frequencyData.length),this.delta)for(var o=0;o<this.delta.length;o+=1)this.delta[o]=Math.abs(this.frequencyData[o]-this.frequency2Data[o]);for(var n=0,s=(this.delta.length*this.drumTreshold).toFixed(0),r=(this.delta.length*this.drumTreshold2).toFixed(0),o=s;o<r;o++)n+=this.delta[o];var a=n-this.drum;this.deltaDrum=this.smoothingDrums*this.deltaDrum+(1-this.smoothingDrums)*a,this.drum=this.smoothingDrums2*this.drum+(1-this.smoothingDrums2)*n,this.drumValue=Math.max(0,Math.abs(.005*this.deltaDrum)),this.drumValue<.25&&(this.drumValue=0)}for(var h=0;h<i.numberOfChannels;h++)for(var u=e.getChannelData(h),l=i.getChannelData(h),c=0;c<e.length;c++)l[c]=0,l[c]=.5*u[c]*this.config.volume},FFTPlayer.prototype.initAudioContext=function(){this.createNodes(),this.connect(),console.debug("initAudioContext, source "+this.source),this.ready()},FFTPlayer.prototype.createNodes=function(){this.source=this.context.createBufferSource();var t=this;this.source.onended=function(){t.config.state="end";var e=document,i=document.createEvent("CustomEvent");i.initCustomEvent("AudioCompleteEvent",!0,!0,{}),e.dispatchEvent(i)},this.source.buffer=this.buffer,this.lowpass=this.context.createBiquadFilter(),this.lowpass.type="lowpass",this.lowpass.frequency.value=this.config.lowpass*this.LOW_PASS_MULTIPLY,this.gainNode=this.context.createGain(),this.gainNode.gain.value=this.config.volume,this.analyser=this.context.createAnalyser(),this.analyser.smoothingTimeConstant=this.smoothing,this.analyser.fftSize=this.fftSize,this.analyser2=this.context.createAnalyser(),this.analyser2.smoothingTimeConstant=this.smoothing2,this.analyser2.fftSize=this.fftSize,this.splitter=this.context.createChannelSplitter();var e=this.analyser.frequencyBinCount,i=this.analyser.fftSize;this.frequencyData=new Uint8Array(e),this.frequency2Data=new Uint8Array(e),this.floatFrequencyData=new Float32Array(e),this.timeDomainData=new Uint8Array(i),this.floatTimeDomainData=new Float32Array(i),this.delta=new Float32Array(e),this.scriptProcessor=this.context.createScriptProcessor(this.bufferSize,1,1),this.scriptProcessor.buffer=this.buffer;var t=this;this.scriptProcessor.onaudioprocess=function(e){t.analyze(e)}},FFTPlayer.prototype.connect=function(){this.source.connect(this.gainNode),this.gainNode.connect(this.splitter),this.splitter.connect(this.analyser,0,0),this.splitter.connect(this.analyser2,1,0),this.analyser.connect(this.lowpass),this.lowpass.connect(this.scriptProcessor),this.scriptProcessor.connect(this.context.destination)},FFTPlayer.prototype.onLoadListener=function(t){console.debug("onLoadListener");var e=this;this.context.decodeAudioData(this.request.response,function(t){return t?(e.buffer=t,void e.initAudioContext()):void console.log("Error decoding file data")},function(t){console.log("Error decoding file data")})},FFTPlayer.prototype.loadAudio=function(t){console.debug("load "+t),this.request=new XMLHttpRequest,this.request.responseType="arraybuffer";var e=this;this.request.onload=function(t){e.onLoadListener(t)},this.request.open("GET",t,!0),this.request.send()},FFTPlayer.prototype.resetOffset=function(){this.timeOffset=0},FFTPlayer.prototype.play=function(){console.info("play ",this.context.currentTime),this.started=!0,this.timeOffset=this.context.currentTime,this.source.start(0)},FFTPlayer.prototype.resume=function(){if(console.info("resume"),this.context.state)this.context.resume();else{this.source=this.context.createBufferSource(),this.source.buffer=this.buffer,this.connect();var t=this;this.source.onended=function(){t.config.state="end";var e=document,i=document.createEvent("CustomEvent");i.initCustomEvent("AudioCompleteEvent",!0,!0,{}),e.dispatchEvent(i)},this.source.start(0)}},FFTPlayer.prototype.pause=function(){console.log("pause"),this.context.state?(this.context.suspend(),console.log("suspend")):(this.source.stop(0),console.log("stop"))},FFTPlayer.prototype.stop=function(){console.info("stop"),this.timeOffset=this.context.currentTime,this.source&&this.source.stop(0)},FFTPlayer.prototype.seek=function(t){t=Math.abs(t),this.source.stop(0);var e=this.source.buffer.duration.toFixed(2)*t;console.info("seek "+t.toFixed(2)+" duration "+this.source.buffer.duration.toFixed(2)+" offset "+this.timeOffset.toFixed(2)),this.timeOffset=-e,this.source=this.context.createBufferSource(),this.source.buffer=this.buffer,this.connect();var i=this;this.source.onended=function(){i.config.state="end";var t=document,e=document.createEvent("CustomEvent");e.initCustomEvent("AudioCompleteEvent",!0,!0,{}),t.dispatchEvent(e)},this.source.start(0,e),this.onSeek(t)},FFTPlayer.prototype.onSeek=function(t){},FFTPlayer.prototype.togglePlay=function(){console.info("[app.js] togglePlay"),1==this.isPlaying()?this.pause():this.resume()},FFTPlayer.prototype.toggleMute=function(){this.muted=!this.muted,1==this.muted?(this.savedVolume=this.config.volume,this.config.volume=0,this.gainNode.value=0):(this.config.volume=this.savedVolume,this.gainNode.value=this.config.volume),console.log("toggleMute "+this.gainNode.value)},FFTPlayer.prototype.setVolume=function(t){this.config.volume=t,this.gainNode.value=this.config.volume},FFTPlayer.prototype.setFilter=function(t){this.config.lowpass=t,this.lowpass.frequency.value=this.config.lowpass*this.LOW_PASS_MULTIPLY},FFTPlayer.prototype.isPlaying=function(){return this.context.state?"running"==this.context.state:2==this.source.playbackState},FFTPlayer.prototype.getState=function(){return this.context.state},FFTPlayer.prototype.getCurrentTime=function(){return this.context?"end"==this.config.state?this.source.buffer.duration:"running"==this.context.state&&1==this.started?this.context.currentTime-this.timeOffset:0:-1},FFTPlayer.prototype.getDuration=function(){return this.source?this.source.buffer.duration:-1},FFTPlayer.prototype.getProgress=function(){return this.source?"end"==this.config.state?1:this.context&&this.source.buffer&&1==this.started?(this.context.currentTime-this.timeOffset)/this.source.buffer.duration:0:0},FFTPlayer.prototype.getSampleRate=function(){return this.context.sampleRate},FFTPlayerVisualizer.prototype.loadShader=function(t,e){function i(t){var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),200==e.status?e.responseText:null}var o=i(t),n=i(e);this.mesh.material=new THREE.ShaderMaterial({transparent:!0,uniforms:this.uniforms,vertexShader:o,fragmentShader:n})},FFTPlayerVisualizer.prototype.resize=function(t,e){this.renderer.setSize(window.innerWidth,window.innerHeight),this.uniforms.u_resolution.value.x=this.renderer.domElement.width,this.uniforms.u_resolution.value.y=this.renderer.domElement.height},FFTPlayerVisualizer.prototype.renderValue=function(t){this.uniforms.u_time.value+=.015,this.uniforms.u_volume.value=t,this.renderer.render(this.scene,this.camera)};