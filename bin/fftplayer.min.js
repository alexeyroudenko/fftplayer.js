function FFTHistory(t){this.config=t,this.config.length=400,this.data=new Array(this.config.length)}function FFTPlayer(t){this.version="1.1.0",this.config=t,this.bufferSize=2048,this.fftSize=512,this.timeOffset=0,this.isFirstTouch=null!=navigator.userAgent.match(/iPad/i),this.isTrackEnded=new Event("playlistTrackFinished"),this.volume=1,this.smoothing=.56,this.smoothing2=.9,this.smoothingDrums=.57,this.smoothingDrums2=.06,this.drumTreshold=.66,this.drumTreshold2=.7,this.drum=0,this.deltaDrum=0,this.drumValue=0,this.lowPassFreq1=20400,this.lowPassFreq2=20440,this.createAudioContext()}function FFTPlayerVisualizer(){this.container=document.getElementById("container"),this.uniforms={u_time:{type:"f",value:1},u_volume:{type:"f",value:1},u_volume_minus:{type:"f",value:.3},u_volume_multiply:{type:"f",value:5},u_resolution:{type:"v2",value:new THREE.Vector2}},this.camera=new THREE.Camera,this.camera.position.z=1,this.scene=new THREE.Scene,this.geometry=new THREE.PlaneBufferGeometry(2,2),this.mesh=new THREE.Mesh(this.geometry),this.scene.add(this.mesh),this.renderer=new THREE.WebGLRenderer,this.container.appendChild(this.renderer.domElement)}!function t(e,i,o){function s(n,a){if(!i[n]){if(!e[n]){var h="function"==typeof require&&require;if(!a&&h)return h(n,!0);if(r)return r(n,!0);var l=new Error("Cannot find module '"+n+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[n]={exports:{}};e[n][0].call(u.exports,function(t){var i=e[n][1][t];return s(i?i:t)},u,u.exports,t,e,i,o)}return i[n].exports}for(var r="function"==typeof require&&require,n=0;n<o.length;n++)s(o[n]);return s}({1:[function(t,e,i){(function(t){"use strict";if(t.AnalyserNode&&!t.AnalyserNode.prototype.getFloatTimeDomainData){var e=new Uint8Array(2048);t.AnalyserNode.prototype.getFloatTimeDomainData=function(t){this.getByteTimeDomainData(e);for(var i=0,o=t.length;i<o;i++)t[i]=.0078125*(e[i]-128)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]),FFTPlayer.prototype.clear=function(t){var e=document.getElementById(t),i=e.getContext("2d"),o=e.width,s=e.height;i.clearRect(0,0,o,s)},FFTPlayer.prototype.drawWave=function(t,e){if("undefined"==typeof e&&(e=1),this.floatTimeDomainData){var i=document.getElementById(t),o=i.getContext("2d"),s=i.width,r=i.height,n=s/this.floatTimeDomainData.length/e;o.fillStyle="rgba(255, 255, 255, 0.7)";for(var a=(Math.round(s/n),0);a<this.floatTimeDomainData.length*e;a++){var h=1*a/(this.floatTimeDomainData.length*e),l=5*Math.abs(h-.5),u=2/(1+l*l),c=r*this.floatTimeDomainData[a]*u;o.fillRect(n*a,r/2,n,-1*c/2)}}},FFTPlayer.prototype.drawSpectrum=function(t){if(this.frequencyData){var e=document.getElementById(t),i=e.getContext("2d"),o=e.width,s=e.height,r=o/this.frequencyData.length;if(this.frequencyData){i.fillStyle="rgba(255, 255, 255, 0.7)";for(var n=(Math.round(o/r),0);n<this.frequencyData.length;n++){var a=.4*this.frequencyData[n];i.fillRect(r*n,s,r,-1*a)}}}},FFTPlayer.prototype.drawSelector=function(t,e){var i=document.getElementById(t),o=i.getContext("2d");o.fillStyle="rgba(255, 0, 0, 0.7)",o.fillRect(i.width*e,0,2,i.height)},FFTPlayer.prototype.draw=function(t,e,i){if("undefined"==typeof i&&(i=1),e){var o=document.getElementById(t),s=o.getContext("2d"),r=o.width,n=o.height,a=r/e.length;s.fillStyle="rgba(255, 255, 255, 0.7)";for(var h=(Math.round(r/a),0);h<e.length;h++){var l=.4*e[h];s.fillRect(a*h,n,a,-1*l*i)}}},FFTPlayer.prototype.drawCircle=function(t,e,i,o,s){"undefined"==typeof i&&(i=1),"undefined"==typeof o&&(o=5),"undefined"==typeof s&&(s=1);var r=document.getElementById(t),n=r.getContext("2d");if(e){var a=r.width/2,h=r.height/2,l=window.devicePixelRatio*a*.75;n.fillStyle="rgba(255, 255, 255, 0.7)";for(var u=0;u<e.length*s;u++){var c=2*Math.PI*u/e.length/s,f=a+l*Math.cos(c),d=h+l*Math.sin(c);n.translate(f,d),n.rotate(c);var y=e[u];n.fillRect(0,0,i*y,o),n.setTransform(1,0,0,1,0,0)}}},FFTHistory.prototype.update=function(t){this.data.length>this.config.length&&this.data.shift(),this.data.push(t)},FFTHistory.prototype.draw=function(t){"undefined"==typeof my&&(my=1),"undefined"==typeof r&&(r=2),"undefined"==typeof percents&&(percents=1);var e=document.getElementById(t),i=e.getContext("2d");if(this.data){var e=document.getElementById(t),i=e.getContext("2d"),o=e.width,s=e.height,r=o/this.data.length;i.fillStyle="rgba(255, 255, 255, 0.2)";for(var n=(Math.round(o/r),0);n<this.data.length;n++){var a=100.4*this.data[n];i.fillRect(r*n,s,r,-1*a)}}},FFTPlayer.prototype.createAudioContext=function(){console.log("[FFTPlayer] "+this.version+" createAudioContext");var t=window.AudioContext||window.webkitAudioContext||!1;t?this.context=new t:(console.log("Sorry, but the Web Audio API is not supported by your browser."),console.log("Please, consider upgrading to the latest version or downloading Google Chrome or Mozilla Firefox"))},FFTPlayer.prototype.analyze=function(t){if(this.analyser){this.analyser.smoothingTimeConstant=this.smoothing,this.analyser2.smoothingTimeConstant=this.smoothing2,this.lowpass.frequency.value=this.lowPassFreq1;var e=t.inputBuffer,i=t.outputBuffer;if(this.analyser.getByteFrequencyData(this.frequencyData),this.analyser2.getByteFrequencyData(this.frequency2Data),this.analyser.getFloatFrequencyData(this.floatFrequencyData),this.analyser.getByteTimeDomainData(this.timeDomainData),this.analyser.getFloatTimeDomainData(this.floatTimeDomainData),this.delta=new Float32Array(this.frequencyData.length),this.delta)for(var o=0;o<this.delta.length;o+=1)this.delta[o]=Math.abs(this.frequencyData[o]-this.frequency2Data[o]);for(var s=0,r=(this.delta.length*this.drumTreshold).toFixed(0),n=(this.delta.length*this.drumTreshold2).toFixed(0),o=r;o<n;o++)s+=this.delta[o];var a=s-this.drum;this.deltaDrum=this.smoothingDrums*this.deltaDrum+(1-this.smoothingDrums)*a,this.drum=this.smoothingDrums2*this.drum+(1-this.smoothingDrums2)*s,this.drumValue=Math.max(0,Math.abs(.005*this.deltaDrum)),this.drumValue<.25&&(this.drumValue=0)}for(var h=0;h<i.numberOfChannels;h++)for(var l=e.getChannelData(h),u=i.getChannelData(h),c=0;c<e.length;c++)u[c]=0,u[c]=.5*l[c]},FFTPlayer.prototype.initAudioContext=function(){this.createNodes(),this.connect(),console.log("[FFTPlayer] initAudioContext, source "+this.source),this.ready()},FFTPlayer.prototype.createNodes=function(){this.source=this.context.createBufferSource(),this.source.buffer=this.buffer,this.lowpass=this.context.createBiquadFilter(),this.lowpass.type="lowpass",this.lowpass.frequency.value=this.lowPassFreq1,this.gainNode=this.context.createGain(),this.gainNode.gain.value=1,this.analyser=this.context.createAnalyser(),this.analyser.smoothingTimeConstant=this.smoothing,this.analyser.fftSize=this.fftSize,this.analyser2=this.context.createAnalyser(),this.analyser2.smoothingTimeConstant=this.smoothing2,this.analyser2.fftSize=this.fftSize,this.splitter=this.context.createChannelSplitter();var t=this.analyser.frequencyBinCount,e=this.analyser.fftSize;this.frequencyData=new Uint8Array(t),this.frequency2Data=new Uint8Array(t),this.floatFrequencyData=new Float32Array(t),this.timeDomainData=new Uint8Array(e),this.floatTimeDomainData=new Float32Array(e),this.delta=new Float32Array(t),this.scriptProcessor=this.context.createScriptProcessor(this.bufferSize,1,1),this.scriptProcessor.buffer=this.buffer;var i=this;this.scriptProcessor.onaudioprocess=function(t){i.analyze(t)}},FFTPlayer.prototype.connect=function(){this.source.connect(this.splitter),this.splitter.connect(this.analyser,0,0),this.splitter.connect(this.analyser2,1,0),this.analyser.connect(this.gainNode),this.gainNode.connect(this.lowpass),this.lowpass.connect(this.scriptProcessor),this.scriptProcessor.connect(this.context.destination)},FFTPlayer.prototype.onLoadListener=function(t){console.log("[FFTPlayer] onLoadListener");var e=this;this.context.decodeAudioData(this.request.response,function(t){return t?(e.buffer=t,void e.initAudioContext()):void console.log("Error decoding file data")},function(t){console.log("Error decoding file data")})},FFTPlayer.prototype.loadAudio=function(t){console.log("[FFTPlayer] load "+t),this.request=new XMLHttpRequest,this.request.responseType="arraybuffer";var e=this;this.request.onload=function(t){e.onLoadListener(t)},this.request.open("GET",t,!0),this.request.send()},FFTPlayer.prototype.resetOffset=function(){this.timeOffset=0},FFTPlayer.prototype.play=function(){console.log("[FFTPlayer] play ",this.context.currentTime),this.timeOffset=this.context.currentTime,this.source.start(0),1==this.isFirstTouch&&(this.isFirstTouch=!1)},FFTPlayer.prototype.resume=function(){console.log("[FFTPlayer] resume"),this.context.state?this.context.resume():(this.source=this.context.createBufferSource(),this.source.buffer=this.buffer,this.connect(),this.source.onended=function(){document.dispatchEvent(this.isTrackEnded)},this.source.start(0))},FFTPlayer.prototype.pause=function(){console.log("[FFTPlayer] pause"),this.context.state?(this.context.suspend(),console.log("[FFTPlayer] suspend")):(this.source.stop(0),console.log("[FFTPlayer] stop"))},FFTPlayer.prototype.stop=function(){console.log("[FFTPlayer] stop"),this.timeOffset=this.context.currentTime,this.source&&this.source.stop(0)},FFTPlayer.prototype.seek=function(t){t=Math.abs(t),this.source.stop(0);var e=this.source.buffer.duration.toFixed(2)*t;console.log("[FFTPlayer] seek "+t.toFixed(2)+" duration "+this.source.buffer.duration.toFixed(2)+" offset "+this.timeOffset.toFixed(2)),this.timeOffset=-e,this.source=this.context.createBufferSource(),this.source.buffer=this.buffer,this.connect(),this.source.start(0,e),this.onSeek(t)},FFTPlayer.prototype.onSeek=function(t){},FFTPlayer.prototype.isPlaying=function(){return this.context.state?"running"==this.context.state:2==this.source.playbackState},FFTPlayer.prototype.togglePlay=function(){console.log("[app.js] togglePlay"),1==this.isPlaying()?this.pause():this.resume()},FFTPlayer.prototype.setOutputVolume=function(t){console.log("[app] setOutputVolume "+t),this.gainNode.value=t,this.lowpass.frequency.value=88},FFTPlayer.prototype.getState=function(){return this.context.state},FFTPlayer.prototype.getCurrentTime=function(){return this.context?this.getProgress()==-1?0:this.context.currentTime-this.timeOffset:-1},FFTPlayer.prototype.getDuration=function(){return this.source?this.source.buffer.duration:-1},FFTPlayer.prototype.getProgress=function(){return this.source&&this.context&&this.source.buffer?(this.context.currentTime-this.timeOffset)/this.source.buffer.duration:-1},FFTPlayer.prototype.getSampleRate=function(){return this.context.sampleRate},FFTPlayerVisualizer.prototype.loadShader=function(t,e){function i(t){var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),200==e.status?e.responseText:null}var o=i(t),s=i(e);this.mesh.material=new THREE.ShaderMaterial({transparent:!0,uniforms:this.uniforms,vertexShader:o,fragmentShader:s})},FFTPlayerVisualizer.prototype.resize=function(t,e){this.renderer.setSize(window.innerWidth,window.innerHeight),this.uniforms.u_resolution.value.x=this.renderer.domElement.width,this.uniforms.u_resolution.value.y=this.renderer.domElement.height},FFTPlayerVisualizer.prototype.renderValue=function(t){this.uniforms.u_time.value+=.015,this.uniforms.u_volume.value=t,this.renderer.render(this.scene,this.camera)};